<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <!-- ATUALIZADO: Adicionado viewport-fit=cover para suporte total a telas com notch -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />

    <title>SHEIKO - Protocolo de Elite</title>
    <link rel="manifest" href="manifest.json" />

    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta name="theme-color" content="#ffffff" />
    <meta
      name="description"
      content="Calculadora de Carga e Aquecimento para Powerlifting e Musculação"
    />
    <link rel="apple-touch-icon" href="icon-192.png" />

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />

    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* CORREÇÃO DE ESTABILIDADE PWA */

      /* 1. Travar HTML e Body juntos para evitar overscroll */
      html {
        height: 100%;
        background-color: #ffffff; /* Fundo sólido para evitar flashes */
        overscroll-behavior: none; /* Desativa efeito elástico nativo */
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: 'Outfit', sans-serif;
        overscroll-behavior: none; /* Redundância de segurança */
        overflow-x: hidden;
        /* Padding para Safe Areas (Notch/Barra inferior) */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        background-color: #ffffff;
        -webkit-font-smoothing: antialiased;
        margin: 0;
        height: 100%;
      }

      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type='number'] {
        -moz-appearance: textfield;
      }

      /* 2. Container com Aceleração de Hardware (GPU) */
      #root {
        width: 100%;
        min-height: 100%; /* Evita pulos de layout */
        background-color: #ffffff;
        position: relative;
        z-index: 0;

        /* A MÁGICA: Força renderização via GPU para evitar screen tearing */
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        perspective: 1000px;
      }

      /* ANIMAÇÕES PERSONALIZADAS SOLICITADAS */
      .logo-splash {
        animation: fadeIn 0.5s ease-out forwards;
        opacity: 0;
      }

      /* CORREÇÃO PASSO 1: Animação simplificada para evitar layout thrashing com teclado */
      .fade-in {
        animation: fadeIn 0.5s ease-out; /* Tempo ajustado */
        will-change: opacity; /* Otimização para o navegador */
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        } /* Removido transform scale/translate */
        to {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body class="bg-white text-black">
    <div id="root"></div>

    <script type="text/babel">
      if (
        typeof Chart !== 'undefined' &&
        typeof ChartDataLabels !== 'undefined'
      ) {
        Chart.register(ChartDataLabels);
      }

      // --- ÍCONES ---
      const Dumbbell = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <path d='m6.5 6.5 11 11' />
          <path d='m21 21-1-1' />
          <path d='m3 3 1 1' />
          <path d='m18 22 4-4' />
          <path d='m2 6 4-4' />
          <path d='m3 10 7-7' />
          <path d='m14 21 7-7' />
        </svg>
      );
      const Calculator = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <rect width='16' height='20' x='4' y='2' rx='2' />
          <line x1='8' x2='16' y1='6' y2='6' />
          <line x1='16' x2='16' y1='14' y2='18' />
          <path d='M16 10h.01' />
          <path d='M12 10h.01' />
          <path d='M8 10h.01' />
          <path d='M12 14h.01' />
          <path d='M8 14h.01' />
          <path d='M12 18h.01' />
          <path d='M8 18h.01' />
        </svg>
      );
      const Fire = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <path d='M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3.7 2.5 2.2 4.8 2.9 6.8z' />
        </svg>
      );
      const Check = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <polyline points='20 6 9 17 4 12' />
        </svg>
      );
      const ArrowRight = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <path d='M5 12h14' />
          <path d='m12 5 7 7-7 7' />
        </svg>
      );
      const ArrowUp = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <path d='M12 19V5' />
          <path d='m5 12 7-7 7 7' />
        </svg>
      );
      const AlertCircle = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <circle cx='12' cy='12' r='10' />
          <line x1='12' x2='12' y1='8' y2='12' />
          <line x1='12' x2='12.01' y1='16' y2='16' />
        </svg>
      );
      // Ícone BicepsFlexed (Força) - estilo Lucide
      const BicepsFlexed = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <path d='M12.409 13.017A5 5 0 0 1 22 15c0 3.866-4 7-9 7-4.077 0-8.153-.82-10.371-2.462-.426-.316-.631-.832-.62-1.362C2.118 12.723 2.627 2 10 2a3 3 0 0 1 3 3 2 2 0 0 1-2 2c-1.105 0-1.64-.444-2-1' />
          <path d='M15 14a5 5 0 0 0-7.584 2' />
          <path d='M9.964 6.825C8.019 7.977 9.5 13 8 15' />
        </svg>
      );
      // Ícone ChartNoAxesColumnIncreasing (Volume) - estilo Lucide - barras crescentes
      const ChartColumn = ({ className, size = 24 }) => (
        <svg
          xmlns='http://www.w3.org/2000/svg'
          width={size}
          height={size}
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          strokeWidth='2'
          strokeLinecap='round'
          strokeLinejoin='round'
          className={className}
        >
          <line x1='6' x2='6' y1='20' y2='16' />
          <line x1='12' x2='12' y1='20' y2='10' />
          <line x1='18' x2='18' y1='20' y2='4' />
        </svg>
      );

      // --- COMPONENTE DO GRÁFICO ---
      const WarmupChart = ({ sets, workLoad }) => {
        const chartRef = React.useRef(null);
        const chartInstance = React.useRef(null);

        React.useEffect(() => {
          if (!chartRef.current || sets.length === 0) return;

          const ctx = chartRef.current.getContext('2d');

          if (chartInstance.current) {
            chartInstance.current.destroy();
          }

          const chartDataSets = [
            ...sets,
            { weight: parseFloat(workLoad), percent: 100, isWorkSet: true },
          ];

          const labels = chartDataSets.map((_, i) =>
            i === chartDataSets.length - 1 ? 'Work' : `Série ${i + 1}`
          );
          const data = chartDataSets.map((s) => s.weight);
          const percentages = chartDataSets.map((s) => s.percent + '%');

          const minWeight = Math.min(...data);
          const maxWeight = Math.max(...data);

          const customDrawPlugin = {
            id: 'customDrawPlugin',
            afterDatasetsDraw: (chart) => {
              if (!chart || !chart.ctx || !chart.chartArea) return;
              const {
                ctx,
                chartArea: { top, bottom, left, right },
              } = chart;

              chart.data.datasets.forEach((dataset, i) => {
                const meta = chart.getDatasetMeta(i);
                if (meta && !meta.hidden && meta.data) {
                  meta.data.forEach((point, index) => {
                    if (
                      !point ||
                      typeof point.x !== 'number' ||
                      !isFinite(point.x) ||
                      typeof point.y !== 'number' ||
                      !isFinite(point.y)
                    )
                      return;

                    ctx.save();
                    ctx.beginPath();
                    ctx.strokeStyle = '#CBD5E1';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([0, 5]);
                    ctx.lineCap = 'round';
                    ctx.moveTo(point.x, bottom);
                    ctx.lineTo(point.x, point.y);
                    ctx.stroke();
                    ctx.restore();
                  });
                }
              });
            },
          };

          chartInstance.current = new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [
                {
                  label: 'Peso',
                  data: data,
                  borderColor: '#2563EB',
                  // CORREÇÃO: Aumentado para 2 para melhor cobertura e adicionado borderJoinStyle
                  borderWidth: 2,
                  borderJoinStyle: 'round',
                  borderCapStyle: 'round',
                  backgroundColor: (context) => {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 250);
                    gradient.addColorStop(0, 'rgba(37, 99, 235, 0.3)');
                    gradient.addColorStop(1, 'rgba(37, 99, 235, 0.0)');
                    return gradient;
                  },
                  pointBackgroundColor: '#ffffff',
                  pointBorderColor: '#2563EB',
                  pointBorderWidth: 2,
                  pointStyle: 'circle',
                  // ALTERADO: Tamanho fixo 2 para todos os pontos (era condicional 2 ou 1)
                  pointRadius: 2,
                  pointHoverRadius: 6,
                  // CORREÇÃO: Alterado de 0.1 para 0 para eliminar artefatos de renderização
                  tension: 0,
                  fill: true,
                  spanGaps: true, // Garante que não haja quebras se houver dados faltantes
                  clip: false,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              animation: { duration: 600, easing: 'easeOutQuart' },
              layout: { padding: { top: 40, right: 30, left: 30, bottom: 15 } },
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: '#1F2937',
                  padding: 10,
                  titleFont: { family: 'Outfit', size: 12 },
                  bodyFont: { family: 'Outfit', size: 12, weight: 'bold' },
                  callbacks: { label: (context) => `${context.raw}kg` },
                },
                datalabels: {
                  align: 'top',
                  anchor: 'end',
                  // ALTERADO: Reduzido de 6 para 4 conforme solicitado
                  offset: 4,
                  backgroundColor: (ctx) =>
                    ctx.dataIndex === ctx.dataset.data.length - 1
                      ? '#000000'
                      : 'transparent',
                  borderColor: (ctx) =>
                    ctx.dataIndex === ctx.dataset.data.length - 1
                      ? '#000000'
                      : '#E5E7EB',
                  borderWidth: 1,
                  borderRadius: 4,
                  padding: { top: 2, bottom: 2, left: 4, right: 4 },
                  color: (ctx) =>
                    ctx.dataIndex === ctx.dataset.data.length - 1
                      ? '#FFFFFF'
                      : '#6B7280',
                  font: { family: 'Outfit', weight: 'bold', size: 9 },
                  formatter: (value, ctx) => percentages[ctx.dataIndex],
                },
              },
              scales: {
                y: {
                  beginAtZero: false,
                  min: minWeight,
                  max: maxWeight,
                  grid: {
                    display: true,
                    color: '#F3F4F6',
                    borderDash: [5, 5],
                    drawBorder: false,
                  },
                  ticks: { display: false },
                  border: { display: false },
                },
                x: {
                  grid: { display: false, drawBorder: false },
                  ticks: { display: false },
                  border: { display: false },
                },
              },
            },
            plugins: [customDrawPlugin],
          });

          return () => {
            if (chartInstance.current) chartInstance.current.destroy();
          };
        }, [sets, workLoad]);

        if (sets.length === 0) return null;

        return (
          <div className='w-full h-48 bg-white rounded-xl border border-gray-100 shadow-sm p-4 mb-6 relative'>
            <div className='absolute top-4 left-4 z-10'>
              <p className='text-xs font-bold text-gray-400 uppercase tracking-widest'>
                Progressão de Carga
              </p>
            </div>
            <canvas ref={chartRef}></canvas>
          </div>
        );
      };

      // --- COMPONENTE: CALCULADORA 1RM ---
      const OneRepMaxCalc = ({ onCalculateWarmup }) => {
        const [oneRepMax, setOneRepMax] = React.useState('');

        const calculatePercentage = (percent) => {
          if (!oneRepMax) return 0;
          const rawWeight = parseFloat(oneRepMax) * (percent / 100);
          return Math.round(rawWeight / 2) * 2;
        };

        const repRanges = [
          { reps: 5, percent: 75 }, // Mantido 75
          { reps: 8, percent: 70 }, // Mantido 70
          { reps: 12, percent: 65 }, // Mantido 65
          { reps: 15, percent: 60 }, // Mantido 60
        ];

        return (
          <div className='space-y-6 fade-in'>
            <div className='mb-6'>
              <label className='block text-xs font-bold uppercase tracking-widest text-gray-400 mb-3'>
                Seu 1RM (Repetição Máxima)
              </label>
              <div className='relative group'>
                <input
                  type='number'
                  value={oneRepMax}
                  onChange={(e) => setOneRepMax(e.target.value)}
                  placeholder='0'
                  className='w-full text-6xl font-black border-b-4 border-gray-200 py-4 focus:outline-none focus:border-black transition-colors bg-transparent placeholder-gray-200'
                  step='any'
                />
                <span className='absolute right-0 top-1/2 -translate-y-1/2 text-xl font-bold text-gray-400 group-focus-within:text-black transition-colors'>
                  KG
                </span>
              </div>
            </div>

            {oneRepMax > 0 && (
              <div className='grid grid-cols-1 gap-4'>
                {repRanges.map((range) => {
                  const weight = calculatePercentage(range.percent);
                  return (
                    <div
                      key={range.reps}
                      className='flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 hover:border-blue-200 transition-colors'
                      style={{ backgroundColor: '#f9fafb' }}
                    >
                      <div>
                        <div className='flex items-baseline gap-2'>
                          <span className='text-3xl font-black text-gray-800'>
                            {weight}
                          </span>
                          <span className='text-sm font-bold text-gray-400'>
                            kg
                          </span>
                        </div>
                        <div className='text-xs font-bold uppercase tracking-widest text-blue-500 mt-1'>
                          {range.reps} Repetições ({range.percent}%)
                        </div>
                      </div>
                      {/* CORREÇÃO PASSO 2: Forçar fechamento do teclado antes da troca de tela */}
                      <button
                        onClick={() => {
                          // 1. Remove o foco de qualquer input ativo (força o teclado a fechar)
                          if (document.activeElement instanceof HTMLElement) {
                            document.activeElement.blur();
                          }
                          // 2. Executa a troca de tela
                          onCalculateWarmup(weight);
                        }}
                        className='bg-black text-white p-3 rounded-lg hover:bg-gray-800 transition-colors shadow-sm active:scale-95'
                      >
                        <ArrowRight size={20} />
                      </button>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        );
      };

      // --- APLICATIVO SHEIKO ---
      const SheikoApp = () => {
        const [activeTab, setActiveTab] = React.useState('1rm');
        const [workLoad, setWorkLoad] = React.useState('');
        const [sets, setSets] = React.useState([]);
        const [completed, setCompleted] = React.useState([]);

        const handleTransferWarmup = (weight) => {
          setWorkLoad(weight.toString());
          setActiveTab('warmup');
        };

        const calculateWarmup = (targetWeight) => {
          if (!targetWeight || targetWeight < 20) return [];

          // Função auxiliar para arredondar para múltiplo de 10
          const roundToTen = (num) => Math.round(num / 10) * 10;

          // Série de pré-aquecimento (sempre 10kg, 10 reps)
          const preWarmup = {
            weight: 10,
            reps: 10,
            percent: Math.round((10 / targetWeight) * 100),
            isPreWarmup: true,
          };

          // Se o peso de trabalho é muito baixo, retorna apenas pré-aquecimento
          if (targetWeight <= 20) {
            return [preWarmup];
          }

          // Determinar peso inicial baseado na carga de trabalho
          let startWeight = 30;
          if (targetWeight > 300) startWeight = 50;
          else if (targetWeight > 200) startWeight = 40;

          // Determinar salto máximo baseado na carga
          let maxJump = targetWeight <= 150 ? 30 : 40;

          // Último salto antes do work set nunca maior que 10kg
          const lastJumpMax = 10;

          // Calcular o peso da última série de aquecimento (no máximo 10kg do work set)
          let lastWarmup = roundToTen(targetWeight - lastJumpMax);

          // Garantir que a última série seja menor que o peso de trabalho
          if (lastWarmup >= targetWeight) {
            lastWarmup = roundToTen(targetWeight - 10);
          }

          // Se a última série é menor ou igual ao peso inicial
          if (lastWarmup <= startWeight) {
            return [
              preWarmup,
              {
                weight: startWeight,
                reps: 10,
                percent: Math.round((startWeight / targetWeight) * 100),
                isPreWarmup: false,
              },
            ];
          }

          // Gerar séries de aquecimento respeitando salto máximo
          let weights = [startWeight];

          while (true) {
            const currentWeight = weights[weights.length - 1];
            const distanceToLast = lastWarmup - currentWeight;

            // Se já estamos próximos o suficiente ou chegamos na última
            if (distanceToLast <= 0) {
              break;
            }

            // Se o próximo salto nos levaria além ou igual ao último
            if (distanceToLast <= maxJump) {
              if (currentWeight !== lastWarmup) {
                weights.push(lastWarmup);
              }
              break;
            }

            // Adicionar próximo peso com salto máximo permitido
            const nextWeight = roundToTen(currentWeight + maxJump);
            if (nextWeight >= lastWarmup) {
              if (currentWeight !== lastWarmup) {
                weights.push(lastWarmup);
              }
              break;
            }
            weights.push(nextWeight);
          }

          // Garantir que o último peso está na lista
          if (
            weights[weights.length - 1] !== lastWarmup &&
            lastWarmup > weights[weights.length - 1]
          ) {
            weights.push(lastWarmup);
          }

          // Garantir sequência crescente e sem repetições
          weights = [...new Set(weights)].sort((a, b) => a - b);

          // Refinar: garantir que nenhum salto exceda o máximo e o último salto não exceda 10kg
          let refinedWeights = [weights[0]];
          for (let i = 1; i < weights.length; i++) {
            const jump = weights[i] - refinedWeights[refinedWeights.length - 1];
            if (jump > maxJump) {
              // Adicionar pesos intermediários
              let current = refinedWeights[refinedWeights.length - 1];
              while (current + maxJump < weights[i]) {
                current = roundToTen(current + maxJump);
                refinedWeights.push(current);
              }
            }
            refinedWeights.push(weights[i]);
          }
          weights = [...new Set(refinedWeights)].sort((a, b) => a - b);

          // Verificar se o último salto para o work set excede 10kg
          const lastWeight = weights[weights.length - 1];
          const jumpToWork = targetWeight - lastWeight;
          if (
            jumpToWork > lastJumpMax &&
            lastWeight < targetWeight - lastJumpMax
          ) {
            // Adicionar série intermediária
            const intermediateWeight = roundToTen(targetWeight - lastJumpMax);
            if (intermediateWeight > lastWeight) {
              weights.push(intermediateWeight);
            }
          }

          // Limpar duplicatas e ordenar
          weights = [...new Set(weights)].sort((a, b) => a - b);

          // Para pesos > 150kg, garantir mínimo de 5 séries de aquecimento
          if (targetWeight > 150) {
            const minSets = 5;
            while (weights.length < minSets) {
              // Encontrar o maior gap entre séries consecutivas
              let maxGapIndex = 0;
              let maxGap = 0;
              for (let i = 0; i < weights.length - 1; i++) {
                const gap = weights[i + 1] - weights[i];
                if (gap > maxGap) {
                  maxGap = gap;
                  maxGapIndex = i;
                }
              }
              // Inserir peso intermediário no maior gap
              if (maxGap >= 20) {
                const newWeight = roundToTen(
                  (weights[maxGapIndex] + weights[maxGapIndex + 1]) / 2
                );
                weights.splice(maxGapIndex + 1, 0, newWeight);
                weights = [...new Set(weights)].sort((a, b) => a - b);
              } else {
                break; // Não há mais espaço para adicionar séries
              }
            }
          }

          // Aplica lógica de repetições baseada no total de séries
          // 1 série: 10 | 2 séries: 10,2 | 3 séries: 10,5,2 | 4 séries: 10,5,3,2 | 5+: 10,5,3,2,1...
          const warmupSets = weights.map((w, i) => {
            const totalSets = weights.length;
            let reps = 1;

            if (totalSets === 1) {
              reps = 10;
            } else if (totalSets === 2) {
              reps = i === 0 ? 10 : 2;
            } else if (totalSets === 3) {
              reps = [10, 5, 2][i];
            } else if (totalSets === 4) {
              reps = [10, 5, 3, 2][i];
            } else {
              // 5 ou mais séries: 10, 5, 3, 2, 1...
              if (i === 0) reps = 10;
              else if (i === 1) reps = 5;
              else if (i === 2) reps = 3;
              else if (i === 3) reps = 2;
              else reps = 1;
            }

            return {
              weight: w,
              reps: reps,
              percent: Math.round((w / targetWeight) * 100),
              isPreWarmup: false,
            };
          });

          // Retornar pré-aquecimento + séries de aquecimento
          return [preWarmup, ...warmupSets];
        };

        React.useEffect(() => {
          if (workLoad && parseFloat(workLoad) > 0) {
            const calculated = calculateWarmup(parseFloat(workLoad));
            setSets(calculated);
          } else {
            setSets([]);
          }
        }, [workLoad]);

        const toggleSet = (index) => {
          if (completed.includes(index))
            setCompleted(completed.filter((i) => i !== index));
          else setCompleted([...completed, index]);
        };

        return (
          <div className='min-h-screen bg-white text-black font-sans pb-20 selection:bg-blue-100 selection:text-blue-900'>
            <div className='max-w-xl mx-auto px-6 py-8'>
              <div className='mb-8 logo-splash'>
                {' '}
                {/* Adicionado classe aqui */}
                <h1 className='text-4xl font-black tracking-tighter mb-0 text-blue-600'>
                  SHEIKO
                </h1>
                <p className='text-black text-sm font-bold tracking-widest'>
                  Protocolo de Elite
                </p>
              </div>

              <div className='flex p-1 bg-gray-100 rounded-xl mb-8'>
                <button
                  onClick={() => setActiveTab('1rm')}
                  className={`flex-1 py-3 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${
                    activeTab === '1rm'
                      ? 'bg-white text-black shadow-sm border border-gray-100'
                      : 'text-gray-400 hover:text-gray-600'
                  }`}
                >
                  <Calculator size={24} /> 1RM
                </button>
                <button
                  onClick={() => setActiveTab('warmup')}
                  className={`flex-1 py-3 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-2 ${
                    activeTab === 'warmup'
                      ? 'bg-white text-black shadow-sm border border-gray-100'
                      : 'text-gray-400 hover:text-gray-600'
                  }`}
                >
                  <Fire size={24} /> Aquecimento
                </button>
              </div>

              {activeTab === '1rm' ? (
                <OneRepMaxCalc onCalculateWarmup={handleTransferWarmup} />
              ) : (
                <div className='fade-in'>
                  <div className='mb-10'>
                    <label className='block text-xs font-bold uppercase tracking-widest text-gray-400 mb-3'>
                      Carga de Trabalho (Work Set)
                    </label>
                    <div className='relative group'>
                      <input
                        type='number'
                        value={workLoad}
                        onChange={(e) => setWorkLoad(e.target.value)}
                        placeholder='0'
                        className='w-full text-7xl font-black border-b-4 border-gray-200 py-4 focus:outline-none focus:border-black transition-colors bg-transparent placeholder-gray-200'
                        step='any'
                      />
                      <span className='absolute right-0 top-1/2 -translate-y-1/2 text-xl font-bold text-gray-400 group-focus-within:text-black transition-colors'>
                        KG
                      </span>
                    </div>
                  </div>

                  {/* Seletor de Modo */}
                  {sets.length > 0 && (
                    <WarmupChart sets={sets} workLoad={workLoad} />
                  )}

                  <div className='space-y-3 relative'>
                    {sets.filter((s) => s.isPreWarmup).length > 0 && (
                      <div className='flex items-center gap-2 mb-4'>
                        <span className='bg-gray-500 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider'>
                          Pré-aquecimento
                        </span>
                        <div className='h-px bg-gray-200 flex-grow'></div>
                      </div>
                    )}

                    {sets.length > 0 && (
                      <div className='absolute left-[26px] top-10 bottom-10 w-0.5 -z-10'></div>
                    )}

                    {sets.map((set, index) => {
                      const isDone = completed.includes(index);
                      const isNext =
                        !isDone &&
                        (index === 0 || completed.includes(index - 1));
                      const prevWeight =
                        index === 0 ? 0 : sets[index - 1].weight;
                      const jump = index === 0 ? 0 : set.weight - prevWeight;

                      // Verificar se deve mostrar etiqueta de aquecimento
                      const isFirstWarmup =
                        !set.isPreWarmup &&
                        (index === 0 || sets[index - 1].isPreWarmup);

                      return (
                        <React.Fragment key={index}>
                          {isFirstWarmup && (
                            <div className='flex items-center gap-2 mb-4 mt-6'>
                              <span className='bg-black text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider'>
                                Aquecimento
                              </span>
                              <div className='h-px bg-gray-200 flex-grow'></div>
                            </div>
                          )}
                          <div
                            onClick={() => toggleSet(index)}
                            className={`relative flex items-center gap-6 p-4 rounded-xl cursor-pointer transition-all duration-300 group select-none ${
                              isDone
                                ? 'opacity-30 grayscale blur-[0.5px]'
                                : 'opacity-100'
                            } ${
                              isNext
                                ? 'bg-black text-white shadow-xl scale-[1.02] translate-x-1 ring-4 ring-blue-50'
                                : 'bg-white border border-gray-100 hover:border-gray-300'
                            }`}
                            style={{
                              backgroundColor: isNext ? '#000' : '#fff',
                            }}
                          >
                            <div
                              className={`flex-shrink-0 w-14 h-14 rounded-full border-2 flex items-center justify-center transition-all ${
                                isNext ? 'border-white' : 'border-current'
                              }`}
                            >
                              {isDone ? (
                                <Check size={24} />
                              ) : (
                                <span className='text-lg font-bold'>
                                  {set.isPreWarmup ? 'P' : index}
                                </span>
                              )}
                            </div>
                            <div className='flex-grow flex flex-col justify-center'>
                              <div className='flex items-baseline gap-2'>
                                <span className='text-4xl font-black tracking-tight leading-none'>
                                  {set.weight}
                                </span>
                                <span className='text-xs font-bold uppercase tracking-wider opacity-70'>
                                  kg
                                </span>
                              </div>
                              <div className='flex items-center gap-3 mt-1'>
                                {index > 0 && !set.isPreWarmup && (
                                  <span
                                    className={`text-[10px] font-bold flex items-center gap-1 px-1.5 py-0.5 rounded ${
                                      isNext
                                        ? 'bg-white/20'
                                        : 'bg-gray-100 text-gray-500'
                                    }`}
                                  >
                                    <ArrowRight size={10} /> +{jump}kg
                                  </span>
                                )}
                                <span className='text-[10px] font-bold opacity-70'>
                                  {set.percent}%
                                </span>
                              </div>
                            </div>
                            <div className='text-right min-w-[60px]'>
                              <div className='text-4xl font-black leading-none'>
                                {set.reps}
                              </div>
                              <div className='text-[9px] uppercase font-bold tracking-widest mt-1 opacity-70'>
                                Reps
                              </div>
                            </div>
                          </div>
                        </React.Fragment>
                      );
                    })}

                    {workLoad && sets.length > 0 && (
                      <div className='pt-8'>
                        <div className='flex items-center gap-2 mb-4'>
                          <span className='bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider'>
                            Work Set
                          </span>
                          <div className='h-px bg-blue-100 flex-grow'></div>
                        </div>
                        <div className='flex items-center gap-6 p-6 rounded-2xl border-2 border-blue-600 bg-blue-50 shadow-sm relative overflow-hidden relative z-10 bg-white'>
                          <div className='w-14 h-14 bg-blue-600 rounded-full flex items-center justify-center text-white shrink-0 z-10 shadow-lg shadow-blue-200'>
                            <Dumbbell size={24} />
                          </div>
                          <div className='z-10'>
                            <div className='text-xs font-bold uppercase tracking-widest text-blue-400 mb-1'>
                              Séries de Trabalho
                            </div>
                            <div className='flex items-baseline gap-2'>
                              <span className='text-5xl font-black text-black tracking-tighter'>
                                {workLoad}
                              </span>
                              <span className='text-xl text-gray-400 font-bold'>
                                KG
                              </span>
                            </div>
                            <div className='mt-2 inline-flex bg-white px-3 py-1 rounded-full text-xs font-bold text-blue-600 shadow-sm border border-blue-100'>
                              Work Set
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<SheikoApp />);
    </script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('./sw.js?v=4.0')
            .then((reg) => {
              console.log('SW registrado com sucesso:', reg.scope);
              reg.update();
            })
            .catch((err) => console.error('Erro ao registrar SW:', err));
        });
      }
    </script>
  </body>
</html>
